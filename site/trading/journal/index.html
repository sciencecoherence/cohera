<!doctype html><html lang="en"><head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Trading Journal · Cohera Trading</title>
<link rel="stylesheet" href="/cohera/trading/assets/style.css" />
</head><body>
<header><div class="container nav"><strong>Cohera Trading</strong><nav class="nav-links"><a href="/cohera/trading/index.html">Home</a><a href="/cohera/trading/btc-playbook-v1.html">Playbook</a><a href="/cohera/trading/journal/index.html">Journal</a><a href="/cohera/trading/signals/index.html">Signals</a></nav></div></header>
<main class="container">
<section class="hero"><h1>Trading Journal</h1><p class="small">Discipline > prediction. Every trade gets logged, reviewed, and scored.</p></section>
<section class="card">
  <h3>How to use this journal</h3>
  <ul>
    <li>Log every trade immediately after execution.</li>
    <li>Attach chart screenshot before + after.</li>
    <li>Record result in <strong>R</strong> (not only USD).</li>
    <li>Tag mistakes honestly.</li>
  </ul>
</section>
<section class="card">
  <h3>Template (copy per trade)</h3>
  <pre style="white-space:pre-wrap;color:#cdd6f4">Date/Time:
Pair:
Setup: (Absorb→Raid→Reclaim / Breakdown Retest)
Bias (W/D):
Entry:
Stop:
TP1:
TP2:
Risk %:
Position size:
Result (R):
Confidence (pre-trade):
What happened:
Rule breaks (if any):
Lesson:
Next adjustment:
  </pre>
</section>
<section class="card">
  <h3>Current Metrics</h3>
  <div id="metrics" class="small">No metrics yet.</div>
</section>
<section class="card">
  <h3>Trade History (latest first)</h3>
  <div id="trades" class="small">Loading trade details…</div>
</section>
</main>
<script>
async function loadMetrics(){
  const el=document.getElementById('metrics');
  try{
    const r=await fetch('/cohera/trading/journal/metrics.json',{cache:'no-store'});
    const m=await r.json();
    el.innerHTML=`Win rate: <strong>${m.win_rate||0}%</strong><br/>Avg win (R): <strong>${m.avg_win_r||0}</strong><br/>Avg loss (R): <strong>${m.avg_loss_r||0}</strong><br/>Expectancy (R): <strong>${m.expectancy_r||0}</strong><br/>Trades: <strong>${m.total_trades||0}</strong><br/>Updated: <strong>${m.updated_at||'n/a'}</strong>`;
  }catch(e){ el.textContent='Metrics file not found yet.'; }
}

function parseCsv(text){
  const lines=text.trim().split(/\r?\n/);
  if(lines.length<=1) return [];
  const headers=lines[0].split(',');
  return lines.slice(1).map(line=>{
    const cols=[];
    let cur='';
    let inQ=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch==='"') inQ=!inQ;
      else if(ch===',' && !inQ){ cols.push(cur); cur=''; }
      else cur+=ch;
    }
    cols.push(cur);
    const row={};
    headers.forEach((h,idx)=>row[h]=cols[idx]??'');
    return row;
  });
}

async function loadTrades(){
  const el=document.getElementById('trades');
  try{
    const r=await fetch('/cohera/trading/journal/trades.csv',{cache:'no-store'});
    const txt=await r.text();
    const rows=parseCsv(txt).filter(x=>x.date_time).reverse();
    if(!rows.length){ el.textContent='No trade entries yet.'; return; }
    el.innerHTML='<ul>'+rows.map(t=>`<li><strong>${t.date_time}</strong> · ${t.pair} · ${t.setup} · size $${t.size} · result <strong>${t.result_r}R</strong> · ${t.lesson||''}</li>`).join('')+'</ul>';
  }catch(e){ el.textContent='Could not load trade details.'; }
}

loadMetrics();
loadTrades();
</script>
</body></html>
